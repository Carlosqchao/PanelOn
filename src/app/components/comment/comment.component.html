<div class="comment-container">
  <img [src]="userIcon" alt="User Icon" class="user-icon">
  <div class="comment-content">
    <h3 class="username">{{ username }}</h3>
    <p class="timestamp">{{ comment.created_at | date:'short' }}</p>
    <p *ngIf="!isEditing" class="comment-text">{{ comment.content }}</p>
    <textarea *ngIf="isEditing" [(ngModel)]="editedContent" class="edit-textarea"></textarea>
    <div class="comment-actions">
      <button [disabled]="isEditing || showReplyForm" (click)="toggleReplyForm()">
        {{ 'comment.reply' | translate }}
      </button>
      <button *ngIf="isCommentOwner" [disabled]="showReplyForm" (click)="toggleEdit()">
        {{ isEditing ? ('comment.save' | translate) : ('comment.edit' | translate) }}
      </button>
      <button *ngIf="isCommentOwner" [disabled]="isEditing || showReplyForm" (click)="delete()">
        {{ 'comment.delete' | translate }}
      </button>
    </div>

    <div *ngIf="showReplyForm" class="reply-form">
      <textarea
        [(ngModel)]="newReplyContent"
        [placeholder]="'comment.replyPlaceholder' | translate"
        class="reply-textarea"
      ></textarea>
      <div class="form-buttons">
        <button (click)="addReply()">{{ 'comment.submitReply' | translate }}</button>
        <button class="cancel-btn" (click)="toggleReplyForm()">{{ 'comment.cancel' | translate }}</button>
      </div>
    </div>
  </div>
</div>

<div class="replies-container" *ngIf="comment.replies && comment.replies.length > 0">
  <div class="reply-wrapper" *ngFor="let reply of visibleReplies; let i = index">
    <div class="reply-indicator" *ngIf="i > 0 || parentCommentId">
      <span class="reply-arrow">â†ª</span>
      {{ 'comment.replyingTo' | translate }} <span class="reply-username"> &nbsp; {{ getRepliedToUsername(i) }}</span>
    </div>

    <app-comment
      [comment]="reply"
      [comicId]="comicId"
      [parentCommentId]="comment.id || ''"
      [currentUserId]="currentUserId"
      [parentUsername]="username"
      (deleteEvent)="onDeleteReply($event)"
      (updateEvent)="onUpdateReply($event)">
    </app-comment>
  </div>

  <button *ngIf="hasMoreReplies" class="view-more-btn" (click)="toggleShowAllReplies()">
    {{ 'comment.showMore' | translate: { count: comment.replies.length - maxVisibleReplies } }}
  </button>
</div>
