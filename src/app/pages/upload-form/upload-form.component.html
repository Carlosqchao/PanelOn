<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
<form (ngSubmit)="onSubmit()">
  <div class="aside-img">
    <img src="https://media.mycomicshop.com/n_iv/600/1168751.jpg" alt="Comic Cover">
  </div>
  <div class="form-container">

    <div class="inner-form-container">
      <div class="file-upload">
        <div class="circle" [ngClass]="{ 'circle-empty': filePreview }">


        <label for="file" class="file-label">
            <ng-container *ngIf="!filePreview; else fileIcon">
              <i class="fas fa-upload fa-2x"></i>
            </ng-container>

            <ng-template #fileIcon>
              <div class="file-preview">
                <i class="fas fa-file-pdf fa-3x"></i>
                <br>
                <p>{{ selectedFile?.name }}</p>
              </div>
            </ng-template>

            <input type="file" id="file" (change)="onFileSelected($event)" name="file" style="display: none">
          </label>
        </div>
        <div *ngIf="formSubmitted && (!isFileValid() || invalidFile || !isSizeValid)" class="file-warning">
          <p style="color: red;">
            Please select a valid PDF. Max size: 100MB.
          </p>
        </div>


      </div>

      <div *ngIf="loadingStatus === 'clean' || loadingStatus === 'nsfw'"
           [ngClass]="{
       'message': true,
       'clean-message': loadingStatus === 'clean',
       'nsfw-message': loadingStatus === 'nsfw'
     }">
        {{ loadingStatus === 'clean' ? ' The PDF is valid' : ' The PDF violates the Terms and Conditions' }}
      </div>


      <div *ngIf="loadingStatus" class="progress-bar">
        <div class="progress" [ngClass]="{
            'loading': loadingStatus === 'loading',
            'clean': loadingStatus === 'clean',
            'nsfw': loadingStatus === 'nsfw'
        }"></div>
      </div>


      <div style="align-self: flex-start;">
        <nav aria-label="Go back">
          <a id="back-link"   href="#" onclick="history.back(); return false"> &larr; Go back</a>
        </nav>
      </div>

      <div class="title">
        <input
          type="text"
          name="title"
          placeholder="Title"
          [(ngModel)]="title"
          #titleInput="ngModel"
          required
          [ngClass]="{ 'invalid': !isValidTitle() && titleInput.touched }"
        >
        <div *ngIf="!isValidTitle() && formSubmitted" class="error-message">
          Invalid title. Only letters, numbers, and common punctuation allowed. Length: 2–50 chars.
        </div>
      </div>


      <div class="title">
        <input type="text"
               id="author"
               name="author"
               placeholder="Author"
               [(ngModel)]="author"
               #authorInput="ngModel"
               required
               [ngClass]="{ 'invalid': !isValidTitle() && authorInput.touched }"
        >
        <div *ngIf="!isValidAuthor() && formSubmitted" class="error-message">
          Invalid author. Only letters, numbers, and common punctuation allowed. Length: 2–50 chars.
        </div>
      </div>
      <div class="title">
        <textarea id="synopsis" [(ngModel)]="synopsis" name="synopsis" placeholder="Synopsys" rows="4" cols="50"></textarea>
      </div>


      <div class="state-container">
        <select id="situation" [(ngModel)]="situation" name="situation" required>
          <option value="" disabled selected>State</option>
          <option value="In process">In process</option>
          <option value="Finished">Finished</option>
        </select>
        <div *ngIf="formSubmitted && situation === ''" class="error-message">
          Please select a state.
        </div>
      </div>

      <div class="genre-container">
        <select
          id="genre"
          [(ngModel)]="selectedGenre"
          name="selectedGenre"
          [ngClass]="{ 'invalid': selectedGenres.length === 0 && formSubmitted }"
        >
          <option value="" disabled selected>Select Genre</option>
          <option *ngFor="let genre of genres" [value]="genre">{{ genre }}</option>
        </select>
        <button type="button" (click)="addGenre()">Add</button>
      </div>
      <div class="genre-list">
        <p>Selected Genres (click to remove):</p>
        <span
          *ngFor="let genre of selectedGenres"
          class="genre-item"
          (click)="removeGenre(genre)"
          style="cursor: pointer; margin-right: 8px;"
        >
    {{ genre }}
          <i class="fas fa-times" style="margin-left: 4px; color: red;"></i>
  </span>
      </div>


      <div *ngIf="selectedGenres.length === 0 && formSubmitted" class="error-message">
        Please select at least one genre.
      </div>

      <div class="state-container">
        <select
          id="pegi"
          [(ngModel)]="selectedPegi"
          name="selectedPegi"
          required
          [ngClass]="{ 'invalid': !isPegiSelected() && formSubmitted }"
        >
          <option value="" disabled selected>Define a PEGI</option>
          <option value="PEGI 3">PEGI 3</option>
          <option value="PEGI 7">PEGI 7</option>
          <option value="PEGI 12">PEGI 12</option>
          <option value="PEGI 16">PEGI 16</option>
          <option value="PEGI 18">PEGI 18</option>
        </select>

        <div *ngIf="!isPegiSelected() && formSubmitted" class="error-message">
          Please select a PEGI rating.
        </div>
      </div>


      <div class="upload-button">
        <app-button text="UPLOAD"></app-button>
      </div>
    </div>
  </div>
</form>
