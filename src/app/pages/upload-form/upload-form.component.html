<form #uploadForm="ngForm" (ngSubmit)="onSubmit(uploadForm)">
  <div class="aside-img">
    <img src="https://www.reawakentheory.com/cdn/shop/files/IMG20240307131919.jpg?v=1712027062&width=823" alt="Comic Cover">
  </div>
  <div class="form-container">
    <div class="inner-form-container">
      <div class="file-upload">
        <div class="circle" [ngClass]="{ 'circle-empty': filePreview }">
          <label for="file" class="file-label">
            <ng-container *ngIf="!filePreview; else fileIcon">
              <i class="fas fa-upload fa-2x"></i>
            </ng-container>

            <ng-template #fileIcon>
              <div class="file-preview">
                <i class="fas fa-file-pdf fa-3x"></i>
                <br>
                <p>{{ getShortFileName(selectedFile?.name) }}</p>
              </div>
            </ng-template>

            <input type="file" id="file" (change)="onFileSelected($event)" name="file" style="display: none">
          </label>
        </div>
        <div *ngIf="formSubmitted && (!isFileValid() || invalidFile || !isSizeValid)" class="file-warning">
          <p style="color: red;">
            {{ 'uploadComic.fileValidationError' | translate }}
          </p>
        </div>
      </div>

      <div *ngIf="nsfwResult">
        <div *ngIf="loadingStatus === 'clean'" class="message clean-message">
          {{ 'uploadComic.pdfClean' | translate }} {{ nsfwResult.pegi }}
        </div>
        <div *ngIf="loadingStatus === 'nsfw'" class="message nsfw-message">
          {{ 'uploadComic.pdfViolation' | translate }}
        </div>
      </div>

      <div *ngIf="loadingStatus" class="progress-bar">
        <div class="progress" [ngClass]="{
            'loading': loadingStatus === 'loading',
            'clean': loadingStatus === 'clean',
            'nsfw': loadingStatus === 'nsfw'
        }"></div>
      </div>

      <a
        class="details-link"
        *ngIf="!isAnalyzingFile && (nsfwResult?.nsfw || violenceDetected) && loadingStatus !== 'loading'"
        (click)="openModal()"
      >
        {{ 'uploadComic.details' | translate }}
      </a>

      <div *ngIf="modalVisible && nsfwResult != null" class="modal">
        <div class="modal-content">
          <span class="close" (click)="closeModal()">&times;</span>
          <h2 *ngIf="nsfwResult?.nsfw">{{ 'NSFW Analysis' | translate }}</h2>
          <h2 *ngIf="violenceDetected">{{ 'Violence Analysis' | translate }}</h2>
          <div *ngFor="let image of imagePreviews">
            <img [src]="image" alt="{{ 'uploadComic.preview' | translate }}" class="preview-image"/>
          </div>
        </div>
      </div>
      <div style="align-self: flex-start;">
        <nav aria-label="Go back">
          <a id="back-link" href="#" onclick="history.back(); return false" style="color: black"> &larr; {{ 'uploadComic.goBack' | translate }}</a>
        </nav>
      </div>

      <div class="title">
        <input
          type="text"
          name="title"
          placeholder="{{ 'uploadComic.title' | translate }}"
          [(ngModel)]="title"
          #titleInput="ngModel"
          required
          [ngClass]="{ 'invalid': !isValidTitle() && titleInput.touched }"
        >
        <div *ngIf="!isValidTitle() && formSubmitted" class="error-message">
          {{ 'uploadComic.titleError' | translate }}
        </div>
      </div>


      <div class="title">
        <input type="text"
               id="author"
               name="author"
               placeholder="{{ 'uploadComic.author' | translate }}"
               [(ngModel)]="author"
               #authorInput="ngModel"
               required
               [ngClass]="{ 'invalid': !isValidTitle() && authorInput.touched }"
        >
        <div *ngIf="!isValidAuthor() && formSubmitted" class="error-message">
          {{ 'uploadComic.authorError' | translate }}
        </div>
      </div>
      <div class="title">
        <textarea id="synopsis" [(ngModel)]="synopsis" name="synopsis" placeholder="{{ 'uploadComic.synopsis' | translate }}" rows="4" cols="50"></textarea>
      </div>


      <div class="state-container">
        <select id="state" [(ngModel)]="state" name="state" required>
          <option value="" disabled selected>{{ 'uploadComic.state' | translate }}</option>
          <option value="In process">{{ 'uploadComic.inProcess' | translate }}</option>
          <option value="Finished">{{ 'uploadComic.finished' | translate }}</option>
        </select>
        <div *ngIf="formSubmitted && state === ''" class="error-message">
          {{ 'uploadComic.stateError' | translate }}
        </div>
      </div>

      <div class="genre-container">
        <select
          id="genre"
          [(ngModel)]="selectedGenre"
          name="selectedGenre"
          [ngClass]="{ 'invalid': selectedGenres.length === 0 && formSubmitted }"
        >
          <option value="" disabled selected>{{ 'uploadComic.selectGenre' | translate }}</option>
          <option *ngFor="let genre of genre" [value]="genre">{{ genre }}</option>
        </select>
        <button type="button" (click)="addGenre()">{{ 'uploadComic.add' | translate }}</button>
      </div>
      <div class="genre-list">
        <p>{{ 'uploadComic.selectedGenres' | translate }}</p>
        <span
          *ngFor="let genre of selectedGenres"
          class="genre-item"
          (click)="removeGenre(genre)"
          style="cursor: pointer; margin-right: 8px;"
        >
    {{ genre }}
          <i class="fas fa-times" style="margin-left: 4px; color: red;"></i>
  </span>
      </div>


      <div *ngIf="selectedGenres.length === 0 && formSubmitted" class="error-message">
        {{ 'uploadComic.genreError' | translate }}
      </div>

      <div *ngIf="uploadSuccess" class="message success-message">
        {{ 'uploadComic.uploadSuccess' | translate }}
      </div>

      <div *ngIf="uploadError" class="message error-message">
        {{ 'uploadComic.uploadError' | translate }}
      </div>

      <div *ngIf="isUploadingFile" class="loading-overlay">
        <div class="spinner"></div>
        <p>{{ 'uploadComic.uploading' | translate }}</p>
      </div>


      <div class="upload-button">
        <button type="submit" class= "upload-form-button">{{ 'uploadComic.upload' | translate }}</button>
      </div>
    </div>
  </div>
</form>
