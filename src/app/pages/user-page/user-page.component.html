<app-header-backlink></app-header-backlink>

<div class="user-page" *ngIf="user">
  <div class="user-info">
    <div class="profile-image-container">
      <img class="userImage" *ngIf="userData?.imageUrl" [src]="userData?.imageUrl">
      <img class="userImage" *ngIf="!userData?.imageUrl" src="assets/images/default-profile-icon.jpg">
      <div class="image-upload-overlay" (click)="openFileSelector()">
        <div class="upload-icon" [class.uploading]="isUploading">
          <span *ngIf="!isUploading">üì∑</span>
          <span *ngIf="isUploading">‚è≥</span>
        </div>
      </div>
    </div>

    <div class="userNameBar">
      <div *ngIf="isEditingUsername; else displayUsername" class="edit-username-container">
        <input
          type="text"
          [(ngModel)]="this.userDataEdit.username"
          class="edit-username-input"
          [placeholder]="'userProfile.usernamePlaceholder' | translate"
          (keyup.enter)="saveUsername()" />
        <div class="edit-actions">
          <button class="action-button save-button" (click)="saveUsername()">‚úì</button>
          <button class="action-button cancel-button" (click)="cancelEdit()">‚úó</button>
        </div>
      </div>

      <ng-template #displayUsername>
        <p class="userName">{{ userData?.username }}</p>
        <button class="pencilIcon" (click)="toggleUsernameEdit()">
          <img class="icon" src="pencilIcon.png">
        </button>
      </ng-template>

      <button class="bellIcon">
        <img class="icon" src="bellIcon.png">
      </button>
    </div>

    <div class="userDescriptionSection">
      <div *ngIf="isEditingDescription; else displayDescription" class="edit-description-container">
        <textarea
          [(ngModel)]="userDataEdit.description"
          class="edit-description-input"
          [placeholder]="'userProfile.descriptionPlaceholder' | translate"
          (keyup.enter)="saveDescription()"></textarea>
        <div class="edit-actions">
          <button class="action-button save-button" (click)="saveDescription()">‚úì</button>
          <button class="action-button cancel-button" (click)="cancelEdit()">‚úó</button>
        </div>
      </div>

      <ng-template #displayDescription>
        <div *ngIf="hasDescription(); else addDescription" class="description-container">
          <div class="description-editable" (click)="toggleDescriptionEdit()">
            <p class="userDescription">{{ userData?.description }}</p>
            <span class="edit-hint">{{ 'userProfile.editHint' | translate }}</span>
          </div>
        </div>

        <ng-template #addDescription>
          <button class="add-description-button" (click)="toggleDescriptionEdit()">
            {{ 'userProfile.addDescription' | translate }}
          </button>
        </ng-template>
      </ng-template>
    </div>

    <div class="subscriptionBar">
      <button class="subscribeButton">
        {{ subscriptionStatus === 'none' ? ('userProfile.activatePlan' | translate) : ('userProfile.activePlan' | translate) }}
      </button>
      <button class="cancelButton" (click)="openModal()">
        <span style="color: red">{{ 'userProfile.cancelSubscription' | translate }}</span>
      </button>
    </div>
  </div>

  <div class="options-container">
    <div class="center-container">
      <app-profile-option imageURL="favouritesIcon.png" [optionName]="'userProfile.saved' | translate" routerLink="/saved-comics-user"></app-profile-option>
      <app-profile-option imageURL="myComicsIcon.png" [optionName]="'userProfile.myComics' | translate" routerLink="/uploaded-comics-user"></app-profile-option>
      <app-profile-option imageURL="wishlistIcon.png" [optionName]="'userProfile.likes' | translate" routerLink="/likes-comics-user"></app-profile-option>
    </div>
  </div>

  <div class="center-container">
    <app-user-metrics [value]="String(savedComicsCount)" [title]="'userProfile.savedComics' | translate"></app-user-metrics>
    <app-user-metrics [value]="String(uploadedComicsCount)" [title]="'userProfile.uploadedComics' | translate"></app-user-metrics>
    <app-user-metrics [value]="String(likedComicsCount)" [title]="'userProfile.likedComics' | translate"></app-user-metrics>
  </div>

  <app-button [text]="'userProfile.uploadComic' | translate" buttonWidth="30rem" buttonHeight="5rem" (click)="callToRead()"></app-button>
</div>
